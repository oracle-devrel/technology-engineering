**MongoDB Replay**

The purpose of MongoDB Replay is to provide support with assessment of a
MongoDB application with Oracle MongoDB API. You can extract statements
from the MongoDB log file and replay it in a test environment with
MongoDB Replay.

**Disclaimer**

The use of the scripts is at your sole risk. All information is provided
\"as -is\", without any warranty of its accuracy, completeness, fitness
for a particular purpose.

MongoDB Replay has been developed to replay the MongoDB statements in
test environments only! Do not use it against production databases.
Oracle does not take any responsibility of possible
problems/issues/damages/data corruptions caused by using MongoDB Replay.

**Useful Links**

- [Tools and Drivers for Oracle Database API for
  MongoDB](https://docs.oracle.com/en/database/oracle/mongodb-api/mgapi/overview-oracle-database-api-mongodb.html#GUID-9B704340-5E1D-4CA9-8944-6296A69221B0)

- [Oracle Database Requirements and
  Configuration](https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/24.4/ordig/enabling-and-configuring-oracle-database-api-mongodb.html#GUID-F79F2BB4-BB6E-4890-AFD7-E21DC4462835)

**Artifacts**

The repository contains source code of two artifacts

**- MDBExtractor.jar**       extracts a stream of commands from a log file
                         generated by a MongoDB instance.

**- MDBApplier.jar**          executes commands extracted during the
                          extraction process against an Oracle MongoDB
                          API instance


**Requirements**

- A variable named MR_CONFIG_DIR has to be set to a directory, where
  configuration and log files are stored.

- JDK version 21 either from Oracle be downloaded from
  <https://www.oracle.com/java/technologies/downloads/#java21> or\
  OpenJDK available in a Linux packages repository or downloaded and
  installed
  from [[https://openjdk.org/](https://openjdk.org/)

### MDBExtractor

**Prerequisites**

- The source MongoDB instance needs to be up and running.

- To extract data from traditional MongoDB log file, enable logging --
  the so-called slow operations at the MongoDB instance level - by
  executing the following command *db.setProfilingLevel(0, -1)*

- To extract data from db.system.profile collection or its dump file,
  enable traditional profiling, by executing the following command
  *db.setProfilingLevel(2*)

- The configuration file \$MR_CONFIG_DIR/MDBExtractConfig.json with the
  required parameter settings is created.

**Quick Start**

Configuration File example:

{

\"OUTPUT_DIR\" : \"/opt/mongo_tests/output\",

\"INPUT_FILE\" : \"/opt/mongo_tests/mongod01.log\",

\"EXCLUDE_COMMANDS\" : \[\"insert\"\],

\"EXECUTION_PLAN_TRACING\" : 0,

\"OUTPUT_MODE\" : \"JSON\"

}

- **OUTPUT_DIR** (default: standard output) defines the directory of the
  output files.

- **INPUT_FILE** (default: standard input) defines the input log file
  generated by a MongoDB Instance with profiling enabled.

- **EXCLUDE_COMMANDS** provides a JSON array with the list of commands,
  which will be ignored during extraction process.

- **EXECUTION_PLAN_TRACING** provides explain() commands, if set to a
  non-zero value. Otherwise only runCommand will be provided in the
  output.

- **OUTPUT_MODE** defines the output format. If set to JSON, the output
  will be formatted in sequence of JSON documents. If set to SCRIPT, the
  output is formatted in NodeJS script, which can be consumed by
  mongosh.

All parameters and the complete description can be found here. (!!!!!!!!
add link)

**Execution**

java -jar ./MDBExtract.jar

This example reads data from a file pointed by INPUT_FILE parameter and
executes found commands against the database pointed by CONNECT_STRING
and DB_NAME.

tail -n 10000 -f ./mongod.log\|java -jar ./MDBExtract.jar

If the INPUT_FILE parameter is not set, MDBExtractor reads the data from
its standard input.

**MDBApplier**

**Prerequisites**

- The target Oracle Database with [[Oracle API for
  MongoDB]{.underline}](https://docs.oracle.com/en/database/oracle/mongodb-api/mgapi/overview-oracle-database-api-mongodb.html#GUID-1CF44843-6294-45F0-8065-B9E8034D6CB1) is
  enabled.

- A subset of the data is defined representing all collections which
  will be traced.

- The configuration file \$MR_CONFIG_DIR/MDBApplierConfig.json with the
  required parameter settings is created.

**Quick Start**

Configuration File example:

{

\"INPUT_FILE\" : \"/opt/mongo_tests/output/oradev.json\",

\"DB_NAME\" : \"test\",

\"LOG_FILE\" : \"/opt/mongo_tests/MDBApply.log\",

\"CONNECT_STRING\" : \"mongodb://mongo-oci.acompany.com/test\"

}

- **INPUT_FILE** (default: standard input) defines the input log file
  generated by a MDBExtractor.

- **DB_NAME** (optional) defines the target database name.

- **LOG_FILE** (default: standard diagnostic output) is the name of log
  file used.

- **CONNECT_STRING** (mandatory) defines the connect string for a target
  MongoDB or Oracle API for MongoDB Instance.

All parameters and the complete description can be found here. (!!! Add
link)

**Execution**

java -jar ./MDBApplier.jar

The example reads data from a file defined by the INPUT_FILE parameter
and executes the commands using the parameters CONNECT_STRING and
DB_NAME.
